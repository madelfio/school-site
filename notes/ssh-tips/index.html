<!DOCTYPE html>
<html lang="en">
<head>
  <title>SSH Tips</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <link rel="stylesheet" href="http://umiacs.umd.edu/~marco/theme/css/marco.css" type="text/css" />
  <link href="http://umiacs.umd.edu/~marco/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Marco D. Adelfio Atom Feed" />

  <!--[if IE]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <!--[if lte IE 7]>
  <link rel="stylesheet" type="text/css" media="all" href="http://umiacs.umd.edu/~marco/css/ie.css"/>
  <script src="http://umiacs.umd.edu/~marco/js/IE8.js" type="text/javascript"></script><![endif]-->

  <!--[if lt IE 7]>
  <link rel="stylesheet" type="text/css" media="all" href="http://umiacs.umd.edu/~marco/css/ie6.css"/><![endif]-->

  <script>var siteurl = "http://umiacs.umd.edu/~marco";</script>
</head>

<body id="index" class="home">
  <header id="banner">
  <h1><a href="http://umiacs.umd.edu/~marco/">Marco D. Adelfio </a></h1>
  <nav><ul>
    <li><a href="http://umiacs.umd.edu/~marco/projects">Projects</a></li>
    <li><a href="http://umiacs.umd.edu/~marco/publications">Publications</a></li>
    <li><a href="http://umiacs.umd.edu/~marco/links">Links</a></li>
    <li><a href="http://umiacs.umd.edu/~marco/about">About</a></li>
  </ul></nav>
  </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header class="entry-header">
      <h1 class="entry-title">
        <a href="http://umiacs.umd.edu/~marco/notes/ssh-tips" rel="bookmark"
           title="Permalink to SSH Tips">SSH Tips</a></h1>
       <h3 class="entry-subtitle">Tips for SSH'ing around the lab machines</h3>
    </header>

    <div class="entry-content">
      <p><em>These are instructions for using ssh to access a machine that doesn't have a
public IP address by going through one that does.  They're written for
machines on the UMIACS network at UMD, but should apply generically.</em></p>
<hr />

<p>Say you're on your home computer, which we'll call "home-pc", and want to ssh
to a lab computer, "lab-pc".  You probably can't do this directly because most
of the UMIACS lab machines don't have public IP addresses:</p>
<div class="highlight"><pre><span class="gp">user@home-pc:~$</span> host lab-pc.umiacs.umd.edu
<span class="go">lab-pc.umiacs.umd.edu has address 192.168.83.91</span>
</pre></div>


<p>The 192.168.0.0/16 block is a private IP block inside the UMIACS network, so
this means you can't directly access lab-pc.umiacs.umd.edu from other
networks. But some hosts on the UMIACS network, like
openlab.umiacs.umd.edu, are publicly accessible:</p>
<div class="highlight"><pre><span class="gp">user@home-pc:~$</span> host openlab.umiacs.umd.edu
<span class="go">openlab.umiacs.umd.edu has address 128.8.132.247</span>
<span class="go">openlab.umiacs.umd.edu has address 128.8.132.248</span>
</pre></div>


<p>This means you can go through openlab to get to the lab machines.</p>
<div class="highlight"><pre><span class="gp">user@home-pc:~$</span> ssh openlab.umiacs.umd.edu
<span class="go">user@openlab.umiacs.umd.edu&#39;s password:</span>
<span class="gp">user@opensub00:~$</span> ssh lab-pc.umiacs.umd.edu
<span class="go">user@lab-pc.umiacs.umd.edu&#39;s password:</span>
<span class="gp">user@lab-pc:~$</span>
</pre></div>


<p>And we're in!  Unfortunately this is tedious because you have to go through
openlab and enter your password twice.  Accessing the lab machines remotely
is much more convenient without these hassles, so let's get rid of them.</p>
<h2>Generate SSH key</h2>
<p>To avoid entering a password every time, you can create an ssh key.  There
are many guides on this, like <a href="https://help.github.com/articles/generating-ssh-keys">this one from github</a>.</p>
<p>The short version is:</p>
<div class="highlight"><pre><span class="gp">user@home-pc:~$</span> ssh-keygen -t rsa
<span class="go">Generating public/private rsa key pair.</span>
<span class="go">Enter file in which to save the key (/home/user/.ssh/id_rsa):</span>
<span class="go">Enter passphrase (empty for no passphrase): [Type a passphrase]</span>
<span class="go">Enter same passphrase again: [Type passphrase again]</span>
<span class="gp">user@home-pc:~$</span> ssh-copy-id user@openlab.umiacs.umd.edu
<span class="go">user@openlab.umiacs.umd.edu&#39;s password:</span>
</pre></div>


<p>Now you can ssh to openlab without entering your password (depending on your
OS and system setup, you will need to enter the passphrase for your ssh key,
but you should only need to do this once if you have an ssh agent running).</p>
<div class="highlight"><pre><span class="gp">user@home-pc:~$</span> ssh openlab.umiacs.umd.edu
<span class="gp">user@openlab.umiacs.umd.edu:~$</span>
</pre></div>


<h2>Proxy SSH through openlab</h2>
<p>To avoid manually ssh'ing through openlab.umiacs.umd.edu, you can automate
the process with an ssh "ProxyCommand".  Add the following lines to your
~/.ssh/config file on your remote computer (create it if it doesn't exist),
repeated for each host you'd like to be able to ssh to directly.</p>
<div class="highlight"><pre><span class="n">Host</span> <span class="n">lab</span><span class="o">-</span><span class="n">pc</span>
  <span class="n">Hostname</span> <span class="n">lab</span><span class="o">-</span><span class="n">pc</span><span class="p">.</span><span class="n">umiacs</span><span class="p">.</span><span class="n">umd</span><span class="p">.</span><span class="n">edu</span>
  <span class="n">ForwardAgent</span> <span class="n">yes</span>
  <span class="n">ProxyCommand</span> <span class="n">ssh</span> <span class="n">openlab</span><span class="p">.</span><span class="n">umiacs</span><span class="p">.</span><span class="n">umd</span><span class="p">.</span><span class="n">edu</span> <span class="n">nc</span> <span class="o">%</span><span class="n">h</span> <span class="o">%</span><span class="n">p</span>
</pre></div>


<p>If you have a username (e.g., USERNAME) on the lab-pc and/or the intermediate
machine that's different from your username on your home-pc, you can add the
line <code>User USERNAME</code> within this section of your config and update the
ProxyCommand line with <code>USERNAME@openlab...</code> to get ssh to use the correct
one.</p>
<h2>End result</h2>
<p>Once you generate an ssh key and add the proxy command above, you can ssh into
a lab machine with a single command.</p>
<div class="highlight"><pre><span class="gp">user@home-pc:~$</span> ssh lab-pc
<span class="gp">user@lab-pc.umiacs.umd.edu:~$</span>
</pre></div>


<h4>Updates</h4>
<p>6/20/13 - Reworded some sections for clarity.</p>
<footer class="post-info">
        Posted:
        <abbr class="published" title="2013-02-07T23:47:00">
                Feb 07, 2013
        </abbr>


</footer><!-- /.post-info -->    </div><!-- /.entry-content -->

  </article>
</section>
  <section id="extras" class="body">
  </section><!-- /#extras -->

  <footer id="contentinfo" class="body">
  </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-9669059-5']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    <!-- Start of StatCounter Code -->
    <script type="text/javascript">
      var sc_project=8544392;
      var sc_invisible=1;
      var sc_security="d727ef73";
      var scJsHost = (("https:" == document.location.protocol) ?  "https://secure." : "http://www.");
      document.write("<sc"+"ript type='text/javascript' src='" + scJsHost + "statcounter.com/counter/counter.js'></"+"script>");
    </script>
    <noscript>
      <div class="statcounter">
        <a title="site stats" href="http://statcounter.com/" target="_blank">
          <img class="statcounter" src="http://c.statcounter.com/8544392/0/d727ef73/1/" alt="site stats">
        </a>
      </div>
    </noscript>
    <!-- End of StatCounter Code -->
</body>
</html>